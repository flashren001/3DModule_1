# 几何检测系统安装指南

## 🚀 快速安装

### 步骤 1: 创建虚拟环境（推荐）

```bash
# 使用 conda（推荐）
conda create -n geometry_detection python=3.9
conda activate geometry_detection

# 或使用 venv
python -m venv geometry_env
source geometry_env/bin/activate  # Linux/Mac
# 或 geometry_env\Scripts\activate  # Windows
```

### 步骤 2: 安装依赖包

```bash
# 安装基础依赖
pip install -r requirements.txt

# 或逐个安装主要包
pip install torch torchvision
pip install stable-baselines3
pip install gymnasium
pip install opencv-python
pip install matplotlib seaborn
pip install scikit-learn scikit-image
```

## 📦 详细依赖说明

### 1. stable_baselines3 安装

`stable_baselines3` 是强化学习算法库，提供PPO、SAC、DQN等算法：

```bash
# 基础版本
pip install stable-baselines3

# 包含额外功能
pip install stable-baselines3[extra]

# 开发版本（从GitHub）
pip install git+https://github.com/DLR-RM/stable-baselines3
```

### 2. gymnasium 安装

新版的强化学习环境库（替代gym）：

```bash
pip install gymnasium

# 如果需要额外环境
pip install gymnasium[all]
```

### 3. PyTorch 安装

根据您的系统选择合适的版本：

```bash
# CPU版本
pip install torch torchvision

# GPU版本（CUDA 11.8）
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# GPU版本（CUDA 12.1）
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu121
```

### 4. OpenCV 安装

```bash
# 标准版本
pip install opencv-python

# 包含额外功能
pip install opencv-contrib-python
```

## 🔧 导入使用方法

### stable_baselines3 正确导入

```python
# 基本算法
from stable_baselines3 import PPO, SAC, DQN, A2C, TD3

# 环境相关
from stable_baselines3.common.env_util import make_vec_env
from stable_baselines3.common.vec_env import DummyVecEnv

# 回调和工具
from stable_baselines3.common.callbacks import BaseCallback, EvalCallback
from stable_baselines3.common.utils import set_random_seed
from stable_baselines3.common.evaluation import evaluate_policy

# 策略网络
from stable_baselines3.common.policies import ActorCriticPolicy
```

### gymnasium 正确导入

```python
# 新版 gymnasium（推荐）
import gymnasium as gym
from gymnasium import spaces

# 旧版 gym（兼容性）
import gym
from gym import spaces
```

## 🐛 常见问题解决

### 问题1: stable_baselines3 导入错误

```bash
ImportError: No module named 'stable_baselines3'
```

**解决方法:**
```bash
# 确认安装
pip list | grep stable

# 重新安装
pip uninstall stable-baselines3
pip install stable-baselines3

# 检查Python环境
which python
which pip
```

### 问题2: gymnasium vs gym 冲突

```bash
AttributeError: module 'gym' has no attribute 'make'
```

**解决方法:**
```bash
# 卸载旧版gym，安装gymnasium
pip uninstall gym
pip install gymnasium

# 或同时安装（可能有兼容问题）
pip install gym gymnasium
```

### 问题3: PyTorch CUDA 不可用

```bash
RuntimeError: CUDA not available
```

**解决方法:**
```bash
# 检查CUDA版本
nvidia-smi

# 安装对应CUDA版本的PyTorch
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118
```

### 问题4: OpenCV 导入错误

```bash
ImportError: libGL.so.1: cannot open shared object file
```

**解决方法（Linux）:**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install libgl1-mesa-glx

# CentOS/RHEL
sudo yum install mesa-libGL
```

## 📋 版本兼容性

### Python 版本要求
- Python 3.8 - 3.11（推荐 3.9 或 3.10）

### 主要依赖版本
```
torch >= 2.0.0
stable-baselines3 >= 2.0.0
gymnasium >= 0.28.0
opencv-python >= 4.8.0
numpy >= 1.24.0
```

## 🧪 验证安装

创建测试脚本 `test_installation.py`：

```python
#!/usr/bin/env python3

def test_imports():
    """测试所有关键依赖的导入"""
    try:
        # 测试PyTorch
        import torch
        print(f"✅ PyTorch {torch.__version__}")
        print(f"   CUDA available: {torch.cuda.is_available()}")
        
        # 测试stable_baselines3
        from stable_baselines3 import PPO
        print("✅ stable_baselines3")
        
        # 测试gymnasium
        import gymnasium as gym
        print("✅ gymnasium")
        
        # 测试OpenCV
        import cv2
        print(f"✅ OpenCV {cv2.__version__}")
        
        # 测试其他依赖
        import numpy as np
        print(f"✅ NumPy {np.__version__}")
        
        import matplotlib
        print(f"✅ Matplotlib {matplotlib.__version__}")
        
        print("\n🎉 所有依赖安装成功！")
        return True
        
    except ImportError as e:
        print(f"❌ 导入错误: {e}")
        return False

if __name__ == "__main__":
    test_imports()
```

运行测试：
```bash
python test_installation.py
```

## 🐳 Docker 环境（推荐）

如果遇到依赖问题，可以使用Docker：

```dockerfile
FROM python:3.9-slim

# 安装系统依赖
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    && rm -rf /var/lib/apt/lists/*

# 安装Python依赖
COPY requirements.txt .
RUN pip install -r requirements.txt

WORKDIR /app
COPY . .

CMD ["python", "main.py", "--demo"]
```

构建和运行：
```bash
docker build -t geometry-detection .
docker run geometry-detection
```

## 📞 获取帮助

如果仍然遇到问题：

1. **检查错误日志**: 仔细阅读错误信息
2. **更新pip**: `pip install --upgrade pip`
3. **清理缓存**: `pip cache purge`
4. **重新创建环境**: 删除虚拟环境重新创建
5. **查看官方文档**:
   - [stable_baselines3](https://stable-baselines3.readthedocs.io/)
   - [gymnasium](https://gymnasium.farama.org/)
   - [PyTorch](https://pytorch.org/get-started/locally/)

---

**安装成功后，您就可以运行演示了：**
```bash
python main.py --demo
```